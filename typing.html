<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Typing Master - Advanced</title>
<style>
  :root {
    --primary-color: #4CAF50;
    --secondary-color: #8BC34A;
    --bg-light: #e8f5e9;
    --text-light: #212121;
    --card-bg: #ffffff;
    --border-color: #c8e6c9;
    --shadow-color: rgba(76, 175, 80, 0.2);
  }
  body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; background: var(--bg-light); color: var(--text-light); }
  .container { max-width: 900px; margin: auto; background: var(--card-bg); border-radius: 20px; padding: 30px; box-shadow: 0 15px 30px var(--shadow-color); }
  h1 { text-align: center; margin-bottom: 10px; color: var(--primary-color); }
  p.subtitle { text-align: center; margin-bottom: 30px; color: #666; }
  .controls { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; margin-bottom: 20px; }
  input, select, button { padding: 10px 15px; border-radius: 8px; border: 1.5px solid var(--border-color); font-size: 1rem; }
  button { background: var(--primary-color); color: #fff; border: none; font-weight: 700; cursor: pointer; transition: background 0.3s, transform 0.2s; }
  button:hover:not(:disabled) { background: var(--secondary-color); transform: translateY(-2px); }
  button:disabled { background: #bdbdbd; cursor: not-allowed; }
  .button-group { display: flex; gap: 10px; align-items: center; }
  .stats { display: flex; justify-content: space-around; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
  .stat { background: var(--primary-color); color: white; padding: 20px 30px; border-radius: 15px; flex: 1 1 150px; text-align: center; }
  .stat h2 { margin-bottom: 5px; font-size: 2.2rem; }
  .sample-text, .typing-input { background: var(--bg-light); border-radius: 15px; padding: 25px; font-size: 1.1rem; border: 2px solid var(--border-color); min-height: 160px; margin-bottom: 20px; white-space: pre-wrap; width: 100%; overflow-wrap: break-word; word-wrap: break-word; box-sizing: border-box; }
  .typing-input { resize: none; background-color: var(--card-bg); color: var(--text-light); }
  .typing-input:focus { border-color: var(--primary-color); box-shadow: 0 0 10px var(--shadow-color); }
  .progress-bar-container { background: #e0e0e0; border-radius: 10px; height: 12px; margin: 20px 0; overflow: hidden; }
  .progress-bar { height: 100%; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); width: 0%; transition: width 0.3s ease; }
  .sample-text .correct { color: #28a745; }
  .sample-text .incorrect { color: #dc3545; text-decoration: line-through; }
  .sample-text .current { background: var(--primary-color); color: white; border-radius: 3px; padding: 0 2px; }
  footer { text-align: center; margin-top: 30px; font-size: 0.9rem; color: #888; }
  .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
  .modal.show { display: flex; }
  .modal-content { background: var(--card-bg); padding: 30px; border-radius: 15px; text-align: center; max-width: 420px; width: 90%; }
  .modal-content h2 { color: var(--primary-color); margin-bottom: 15px; }
  .modal-content button { margin: 10px; }
  .leaderboard-container { max-width: 900px; margin: 30px auto 20px auto; background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
  #leaderboard { width: 100%; border-collapse: collapse; }
  #leaderboard th, #leaderboard td { padding: 10px; border-bottom: 1px solid #ddd; text-align: center; }
  #leaderboard th { background: var(--primary-color); color: #fff; }
  #adminLogin { position:fixed; bottom:10px; left:10px; opacity:0.2; font-size:12px; z-index:2000; }
</style>
</head>
<body>

<div class="container">
  <h1>Typing Master - Advanced</h1>
  <p class="subtitle">Test your typing speed and accuracy with multiple difficulty levels and durations</p>

  <div class="controls">
    <label for="username">Name:</label>
    <input type="text" id="username" placeholder="Enter your name" />

    <label for="difficulty">Difficulty:</label>
    <select id="difficulty">
      <option value="easy">Easy</option>
      <option value="medium" selected>Medium</option>
      <option value="hard">Hard</option>
      <option value="code">Code Practice</option>
    </select>

    <label for="duration">Duration:</label>
    <select id="duration">
      <option value="15">15 seconds</option>
      <option value="30">30 seconds</option>
      <option value="60" selected>60 seconds</option>
      <option value="120">120 seconds</option>
      <option value="180">180 seconds</option>
      <option value="300">300 seconds</option>
    </select>

    <!-- Start & Reset Group -->
    <div class="button-group">
      <button id="startBtn">Start Test</button>
      <button id="resetBtn" disabled>Reset</button>
    </div>
  </div>

  <div class="stats">
    <div class="stat"><h2 id="wpm">0</h2><p>WPM</p></div>
    <div class="stat"><h2 id="accuracy">100%</h2><p>Accuracy</p></div>
    <div class="stat"><h2 id="timeLeft">0</h2><p>Seconds Left</p></div>
    <div class="stat"><h2 id="errors">0</h2><p>Errors</p></div>
  </div>

  <div class="sample-text" id="sampleText"></div>
  <textarea id="typingInput" class="typing-input" placeholder="Start typing here..." disabled spellcheck="false"></textarea>
  <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
</div>

<!-- Modal -->
<div id="resultModal" class="modal">
  <div class="modal-content">
    <h2>üéâ Congrats!</h2>
    <p id="resultWPM"></p>
    <p id="resultAccuracy"></p>
    <p id="resultErrors"></p>
    <button class="close-btn" id="closeModal">OK</button>
    <button class="close-btn" id="resetModal">üîÑ Reset Test</button>
  </div>
</div>

<!-- Leaderboard -->
<div class="leaderboard-container">
  <h2>üèÜ Leaderboard (Top 15)</h2>
  <table id="leaderboard">
    <thead>
      <tr>
        <th>Rank</th>
        <th>Name</th>
        <th>WPM</th>
        <th>Accuracy</th>
        <th>Difficulty</th>
        <th>Duration</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="adminControls" style="display:none; margin-top:15px;">
    <button id="clearLeaderboard">üóëÔ∏è Clear Leaderboard</button>
  </div>
</div>

<footer>Created by <strong>KRISHNA KANTH M</strong></footer>

<button id="adminLogin">Admin</button>

<script>
(() => {
  const sampleTexts = {
    easy: ["The quick brown fox jumps over the lazy dog.", "Typing practice daily improves speed."],
    medium: ["Programming is the process of creating instructions for a computer.", "Typing speed improves with accuracy."],
    hard: ["Artificial intelligence and machine learning are transforming industries.", "Cybersecurity is important as data is stored online."],
    code: ["function sumArray(arr){return arr.reduce((a,v)=>a+v,0);}","def factorial(n): return 1 if n==0 else n*factorial(n-1)"]
  };

  let isAdmin = false;

  const difficultySelect = document.getElementById('difficulty');
  const durationSelect = document.getElementById('duration');
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const sampleTextEl = document.getElementById('sampleText');
  const typingInput = document.getElementById('typingInput');
  const wpmEl = document.getElementById('wpm');
  const accuracyEl = document.getElementById('accuracy');
  const timeLeftEl = document.getElementById('timeLeft');
  const errorsEl = document.getElementById('errors');
  const progressBar = document.getElementById('progressBar');
  const resultModal = document.getElementById("resultModal");
  const resultWPM = document.getElementById("resultWPM");
  const resultAccuracy = document.getElementById("resultAccuracy");
  const resultErrors = document.getElementById("resultErrors");
  const closeModal = document.getElementById("closeModal");
  const resetModal = document.getElementById("resetModal");
  const usernameInput = document.getElementById("username");

  let testText = '';
  let timer = null, timeLeft = 0, isTestRunning = false;
  let errors = 0, typedCharacters = 0, correctCharacters = 0;

  function getRandomText(difficulty) {
    const texts = sampleTexts[difficulty];
    if (difficulty === "hard" && parseInt(durationSelect.value) > 240) {
      return texts.join(" ");
    }
    return texts[Math.floor(Math.random() * texts.length)];
  }

  function displaySampleText() {
    sampleTextEl.innerHTML = '';
    testText.split('').forEach(char => {
      const span = document.createElement('span');
      span.textContent = char;
      sampleTextEl.appendChild(span);
    });
    if (sampleTextEl.children.length > 0) sampleTextEl.children[0].classList.add('current');
  }

  function hideModal() { resultModal.classList.remove('show'); }
  function showModal() { resultModal.classList.add('show'); }

  function loadLeaderboard() {
    let scores = JSON.parse(localStorage.getItem("leaderboard") || "[]");
    scores.sort((a,b) => b.wpm - a.wpm);
    const tbody = document.querySelector("#leaderboard tbody");
    tbody.innerHTML = "";
    scores.slice(0, 15).forEach((s, i) => {
      let deleteBtn = isAdmin ? `<button onclick="deleteEntry(${i})">‚ùå</button>` : "";
      const row = `<tr>
        <td>${i+1}</td>
        <td>${s.name}</td>
        <td>${s.wpm}</td>
        <td>${s.accuracy}%</td>
        <td>${s.difficulty}</td>
        <td>${s.duration}s</td>
        <td>${deleteBtn}</td>
      </tr>`;
      tbody.innerHTML += row;
    });
  }

  function initializeTest() {
    if (timer) clearInterval(timer);
    isTestRunning = false;
    errors = 0; typedCharacters = 0; correctCharacters = 0;
    timeLeft = parseInt(durationSelect.value);
    testText = getRandomText(difficultySelect.value);
    displaySampleText();
    typingInput.value = '';
    typingInput.disabled = true;
    startBtn.disabled = false;
    resetBtn.disabled = true;
    wpmEl.textContent = '0';
    accuracyEl.textContent = '100%';
    timeLeftEl.textContent = timeLeft;
    errorsEl.textContent = '0';
    progressBar.style.width = '0%';
    hideModal();
  }

  function startTest() {
    if (!usernameInput.value.trim()) { alert("Please enter your name!"); return; }
    if (isTestRunning) return;
    isTestRunning = true;
    typingInput.value = "";
    typingInput.disabled = false;
    typingInput.focus();
    startBtn.disabled = true;
    resetBtn.disabled = false;
    const startTime = new Date().getTime();
    timer = setInterval(() => {
      const elapsed = (new Date().getTime() - startTime) / 1000;
      const totalDuration = parseInt(durationSelect.value);
      timeLeft = totalDuration - Math.floor(elapsed);
      timeLeftEl.textContent = Math.max(0, timeLeft);
      progressBar.style.width = `${Math.min(100, (elapsed / totalDuration) * 100)}%`;
      if (timeLeft <= 0) endTest();
      else updateStats();
    }, 1000);
  }

  function endTest() {
    if (!isTestRunning) return;
    if (timer) clearInterval(timer);
    timer = null;
    isTestRunning = false;
    typingInput.disabled = true;
    startBtn.disabled = false;
    resetBtn.disabled = false;
    timeLeftEl.textContent = '0';
    progressBar.style.width = '100%';
    updateStats();
    resultWPM.textContent = `WPM: ${wpmEl.textContent}`;
    resultAccuracy.textContent = `Accuracy: ${accuracyEl.textContent}`;
    resultErrors.textContent = `Errors: ${errorsEl.textContent}`;

    const userName = usernameInput.value.trim() || "Guest";
    let scores = JSON.parse(localStorage.getItem("leaderboard") || "[]");

    let newScore = {
      name: userName,
      wpm: parseInt(wpmEl.textContent),
      accuracy: parseFloat(accuracyEl.textContent),
      difficulty: difficultySelect.value,
      duration: durationSelect.value
    };

    // ‚úÖ Replace only if better WPM
    let existingIndex = scores.findIndex(s => s.name === userName);
    if (existingIndex >= 0) {
      if (newScore.wpm > scores[existingIndex].wpm) {
        scores[existingIndex] = newScore;
      }
    } else {
      scores.push(newScore);
    }

    scores.sort((a,b) => b.wpm - a.wpm);
    scores = scores.slice(0, 15);
    localStorage.setItem("leaderboard", JSON.stringify(scores));
    loadLeaderboard();

    showModal();
  }

  function updateStats() {
    const typedText = typingInput.value;
    const totalCharacters = typedText.length;
    let currentErrors = 0, currentCorrectCharacters = 0;
    const sampleSpans = sampleTextEl.querySelectorAll('span');
    sampleSpans.forEach((span, index) => {
      const charInSample = testText[index];
      const charInTyped = typedText[index];
      span.classList.remove('correct', 'incorrect', 'current');
      if (index < totalCharacters) {
        if (charInTyped === charInSample) { span.classList.add('correct'); currentCorrectCharacters++; }
        else { span.classList.add('incorrect'); currentErrors++; }
      }
    });
    if (totalCharacters < testText.length) sampleSpans[totalCharacters].classList.add('current');
    errors = currentErrors; typedCharacters = totalCharacters; correctCharacters = currentCorrectCharacters;
    errorsEl.textContent = errors;
    const elapsedSeconds = parseInt(durationSelect.value) - Math.max(0, timeLeft);
    const netWPM = (elapsedSeconds > 0) ? Math.round(((correctCharacters / 5) / (elapsedSeconds / 60))) : 0;
    wpmEl.textContent = isFinite(netWPM) && netWPM > 0 ? netWPM : 0;
    const accuracy = typedCharacters > 0 ? (correctCharacters / typedCharacters) * 100 : 100;
    accuracyEl.textContent = `${accuracy.toFixed(2)}%`;

    if (isTestRunning && typedText.length >= testText.length) {
      endTest();
    }
  }

  document.getElementById("adminLogin").addEventListener("click", () => {
    let pwd = prompt("Enter admin password:");
    if (pwd === "1411Nazii") {
      isAdmin = true;
      document.getElementById("adminControls").style.display = "block";
      loadLeaderboard();
      alert("Admin mode activated!");
    } else { alert("Wrong password!"); }
  });

  document.getElementById("clearLeaderboard").addEventListener("click", () => {
    if (confirm("Are you sure you want to clear the leaderboard?")) {
      localStorage.removeItem("leaderboard");
      loadLeaderboard();
    }
  });

  window.deleteEntry = function(index) {
    let scores = JSON.parse(localStorage.getItem("leaderboard") || "[]");
    scores.splice(index, 1);
    localStorage.setItem("leaderboard", JSON.stringify(scores));
    loadLeaderboard();
  }

  startBtn.addEventListener('click', startTest);
  resetBtn.addEventListener('click', initializeTest);
  difficultySelect.addEventListener('change', initializeTest);
  durationSelect.addEventListener('change', initializeTest);
  typingInput.addEventListener('input', updateStats);
  closeModal.addEventListener('click', hideModal);
  resetModal.addEventListener('click', () => { hideModal(); initializeTest(); });

  // üö´ Disable copy/paste
  typingInput.addEventListener("paste", e => e.preventDefault());
  typingInput.addEventListener("copy", e => e.preventDefault());
  typingInput.addEventListener("cut", e => e.preventDefault());
  sampleTextEl.addEventListener("copy", e => e.preventDefault());

  initializeTest();
  loadLeaderboard();
})();
</script>
</body>
</html>

